name: Daily next-day summary (22:00 CET)

on:
  schedule:
    - cron: "0 20 * * *"    # příklad – 22:00 CET (20:00 UTC)
  workflow_dispatch:
    inputs:
      pairs:
        description: "Seznam párů oddělený čárkou"
        required: false
        default: "EURUSD,USDJPY"

jobs:
  run-summary:
    runs-on: ubuntu-latest
    env:
      PAIRS: ${{ inputs.pairs != '' && inputs.pairs || 'EURUSD,USDJPY' }}
      TZ: Europe/Prague
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - name: Skip on weekend
        run: |
          dow=$(date +%u); [ "$dow" -ge 6 ] && echo "Víkend – skip." && exit 0 || true
      - name: Run daily summary
        run: |
          echo "Cílové páry: $PAIRS"
          set +e
          python scripts/nextday_summary.py --pairs "$PAIRS"
          code=$?
          if [ $code -eq 2 ]; then echo "Žádná data – OK."; exit 0; fi
          if [ $code -ne 0 ]; then echo "Chyba: $code"; exit $code; fi
          echo "Hotovo."
